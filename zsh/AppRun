#!/bin/bash

# If we’re not already in extract‑and‑run mode, re‑exec ourselves in that mode:
if [[ -z "$APPIMAGE_EXTRACT_AND_RUN" ]]; then
  export APPIMAGE_EXTRACT_AND_RUN=1
  # exec "$0" --appimage-extract-and-run "$@"
  exec "$APPIMAGE" "$@"
fi

export ZDOTDIR="$APPDIR/usr/home/user/.config/zsh"
export PATH="$APPDIR/.pixi/envs/default/bin:$PATH"
pixi reinstall --no-progress --locked --manifest-path $APPDIR/pixi.toml 2>/dev/null

# APPIMAGE_EXTRACT_AND_RUN makes yazi.appimage to have slow startup
if [[ ! -e /.dockerenv ]]; then
  unset APPIMAGE_EXTRACT_AND_RUN
fi

$APPDIR/.pixi/envs/default/bin/zsh $@ # absolute path required by WSL
